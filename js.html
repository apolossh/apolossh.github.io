<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">

<meta http-equiv="Content-Security-Policy" content="
default-src 'self';
script-src 'self';
style-src 'self' 'unsafe-inline';
img-src 'self';
connect-src 'none';
frame-ancestors 'none';
object-src 'none';
base-uri 'none';
form-action 'none';
">

<meta name="referrer" content="no-referrer">
<meta http-equiv="X-Content-Type-Options" content="nosniff">

<title>Auditoria Ativa de Segurança</title>

<style>
body {
    margin:0;
    background:#0e1117;
    color:#e6e6e6;
    font-family:system-ui, sans-serif;
}
.container {
    max-width:900px;
    margin:auto;
    padding:24px;
}
h1 {
    margin-bottom:8px;
}
.grid {
    display:grid;
    grid-template-columns:repeat(auto-fit,minmax(260px,1fr));
    gap:16px;
}
.card {
    background:#161b22;
    border-radius:12px;
    padding:16px;
    border-left:5px solid #2ecc71;
}
.card.warn { border-color:#f1c40f; }
.card.bad { border-color:#e74c3c; }
.status {
    font-weight:700;
}
.log {
    margin-top:24px;
    background:#0b0e13;
    padding:16px;
    border-radius:12px;
    font-family:monospace;
    font-size:13px;
    max-height:240px;
    overflow:auto;
}
</style>
</head>

<body>
<div class="container">
<h1>Auditoria Ativa de Segurança</h1>
<p>Detecção real. Faça sua bagunça e veja o que aparece.</p>

<div class="grid" id="cards"></div>

<div class="log" id="log"></div>
</div>

<script>
'use strict';

const cards = {};
const log = msg => {
    const el = document.getElementById('log');
    el.textContent += `[${new Date().toLocaleTimeString()}] ${msg}\n`;
};

function card(id, title) {
    const d = document.createElement('div');
    d.className = 'card';
    d.innerHTML = `<h3>${title}</h3><p class="status">OK</p>`;
    document.getElementById('cards').appendChild(d);
    cards[id] = d;
}

function warn(id, msg) {
    const c = cards[id];
    if (!c) return;
    c.className = 'card bad';
    c.querySelector('.status').textContent = msg;
    log(msg);
}

/* CARDS */
card('iframe','Execução em iframe');
card('script','Script externo');
card('dom','Modificação crítica do DOM');
card('network','Uso de API de rede');
card('storage','Uso de storage');

/* IFRAME */
setInterval(() => {
    if (window.top !== window.self) {
        warn('iframe','Página rodando em iframe');
    }
}, 500);

/* SCRIPT EXTERNO */
new MutationObserver(m => {
    m.forEach(x => {
        x.addedNodes.forEach(n => {
            if (n.tagName === 'SCRIPT' && n.src && !n.src.startsWith(location.origin)) {
                warn('script','Script externo injetado');
            }
        });
    });
}).observe(document.documentElement,{childList:true,subtree:true});

/* DOM TAKEOVER */
const append = Element.prototype.appendChild;
Element.prototype.appendChild = function(n) {
    if (this === document.body || this === document.documentElement) {
        warn('dom','Tentativa de takeover do DOM');
    }
    return append.call(this,n);
};

/* NETWORK */
['fetch','XMLHttpRequest','WebSocket'].forEach(api=>{
    if (api in window) {
        Object.defineProperty(window, api, {
            get() {
                warn('network','API de rede acessada');
                return undefined;
            }
        });
    }
});

/* STORAGE */
try {
    localStorage.setItem('__t','1');
    warn('storage','localStorage acessível');
} catch(e){}
</script>
</body>
</html>
