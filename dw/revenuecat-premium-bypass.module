#!name=RevenueCat Premium Bypass
#!desc=Modifica respostas da API RevenueCat para simular assinatura premium
#!author=Generated Script
#!homepage=
#!icon=https://raw.githubusercontent.com/Orz-3/mini/master/Color/RevenueCat.png

[Rule]
# RevenueCat API
DOMAIN-SUFFIX,revenuecat.com,MITM

[Script]
# Hook para interceptar respostas da API RevenueCat
revenuecat-premium = type=http-response,pattern=^https://api.revenuecat.com/v1/(subscribers|receipts),requires-body=1,script-path=revenuecat-premium.js

[MITM]
hostname = api.revenuecat.com

# JavaScript para modificar a resposta
***REVENUECAT_SCRIPT_START***
// RevenueCat Premium Bypass Script
// Modifica as respostas para simular assinatura premium ativa

function modifyRevenueCatResponse(response) {
  try {
    let body = $response.body;
    let obj = JSON.parse(body);
    
    if (obj.subscriber) {
      // Modifica dados do subscriber para premium
      obj.subscriber.entitlements = {
        "premium": {
          "expires_date": "2099-12-31T23:59:59Z",
          "grace_period_expires_date": null,
          "product_identifier": "premium_subscription",
          "purchase_date": "2024-01-01T00:00:00Z"
        }
      };
      
      obj.subscriber.subscriptions = {
        "premium_subscription": {
          "billing_issues_detected_at": null,
          "expires_date": "2099-12-31T23:59:59Z",
          "grace_period_expires_date": null,
          "is_sandbox": false,
          "original_purchase_date": "2024-01-01T00:00:00Z",
          "ownership_type": "PURCHASED",
          "period_type": "normal",
          "purchase_date": "2024-01-01T00:00:00Z",
          "store": "app_store",
          "unsubscribe_detected_at": null
        }
      };
      
      obj.subscriber.non_subscriptions = {};
    }
    
    $response.body = JSON.stringify(obj);
  } catch (e) {
    console.log("Erro ao processar resposta RevenueCat: " + e);
  }
}

modifyRevenueCatResponse($response);
***REVENUECAT_SCRIPT_END***