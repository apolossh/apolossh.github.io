<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Enviar Áudio para GitHub</title>
  <style>
    body { font-family: Arial, sans-serif; text-align: center; margin-top: 50px; background: #f9f9f9; }
    input, button { padding: 10px; margin: 10px; border-radius: 8px; border: 1px solid #ccc; width: 280px; }
    button { background-color: #d17c6d; color: white; font-weight: bold; cursor: pointer; }
    button:hover { background-color: #c25d4f; }
    #status { margin-top: 20px; font-size: 18px; }
  </style>
</head>
<body>

  <h1>Upload de Áudio - Teste</h1>

  <input type="text" id="nome" placeholder="Nome da criança"><br>
  <input type="file" id="arquivo" accept="audio/mp3"><br>
  <button onclick="enviarParaGitHub()">Enviar Áudio</button>

  <div id="status"></div>

  <script>
    // Função para "desembaralhar" o token
    function decodeToken(codificado) {
      let base64 = codificado.split('').reverse().join(''); // Inverte a string
      return atob(base64); // Decodifica Base64
    }

    async function enviarParaGitHub() {
      const tokenCodificado = 'ZWJNbDJ3NU0wc3hLa0lzdzkybE8vMHVxY2c3Z2pKempJSjZQcDM='; // Token embaralhado e codificado
      const token = decodeToken(tokenCodificado);

      const repo = 'apolossh/apolossh.github.io';
      const branch = 'main';
      const pasta = 'audios/';

      const nome = document.getElementById('nome').value.trim();
      const arquivoInput = document.getElementById('arquivo');
      const status = document.getElementById('status');

      if (!nome || arquivoInput.files.length === 0) {
        alert('Por favor, preencha o nome da criança e selecione o áudio.');
        return;
      }

      const arquivo = arquivoInput.files[0];
      const leitor = new FileReader();

      leitor.onload = async function(evento) {
        const conteudoBase64 = evento.target.result.split(',')[1];

        const nomeArquivo = nome.toLowerCase()
          .normalize("NFD").replace(/[\u0300-\u036f]/g, "")
          .replace(/\s+/g, "_") + '.mp3';
        const caminhoCompleto = pasta + nomeArquivo;

        try {
          const resposta = await fetch(`https://api.github.com/repos/${repo}/contents/${caminhoCompleto}`, {
            method: 'PUT',
            headers: {
              'Authorization': `token ${token}`,
              'Content-Type': 'application/json'
            },
            body: JSON.stringify({
              message: `Adicionando áudio de ${nome}`,
              content: conteudoBase64,
              branch: branch
            })
          });

          const dados = await resposta.json();

          if (resposta.ok) {
            status.innerHTML = `<p style="color:green;">Áudio enviado com sucesso!<br><a href="https://apolossh.github.io/audios/${encodeURIComponent(nomeArquivo)}" target="_blank">Ouvir Áudio</a></p>`;
          } else {
            status.innerHTML = `<p style="color:red;">Erro: ${dados.message}</p>`;
          }

        } catch (erro) {
          console.error(erro);
          status.innerHTML = `<p style="color:red;">Falha ao enviar!</p>`;
        }
      };

      leitor.readAsDataURL(arquivo);
    }
  </script>

</body>
</html>
